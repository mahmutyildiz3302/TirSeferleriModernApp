<UserControl x:Class="TirSeferleriModernApp.Views.DepoGuzergahTanimView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesignControls="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
             xmlns:conv="clr-namespace:TirSeferleriModernApp.Converters"
             Background="#F0F0F0">
    <UserControl.Resources>
        <conv:GroupStatsConverter x:Key="GroupStatsConverter"/>
        <CollectionViewSource x:Key="GuzergahGrouped">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="CikisDepoAdi"/>
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>
    </UserControl.Resources>
    <Grid Background="#F0F0F0" Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Ust: Depo Tanimi (1/2 ekran) -->
        <Border Grid.Row="0" Background="#E8F0FE" BorderBrush="Gray" BorderThickness="1" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <!-- Form left (Auto) -->
                <Border Grid.Column="0" BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,10,0" VerticalAlignment="Stretch">
                    <StackPanel>
                        <TextBlock Text="Depo Tanimi" FontSize="18" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox x:Name="txtDepoAdi" materialDesignControls:HintAssist.Hint="Depo Adi" Width="300" Margin="0,0,0,5"/>
                        <TextBox x:Name="txtDepoAciklama" materialDesignControls:HintAssist.Hint="Aciklama (opsiyonel)" Width="300" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <Button Content="Kaydet" Width="120" Margin="0,0,10,0" Click="BtnDepoKaydet_Click"/>
                            <Button Content="Guncelle" Width="120" Margin="0,0,10,0" Click="BtnDepoGuncelle_Click"/>
                            <Button Content="Sil" Width="120" Click="BtnDepoSil_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                <!-- DataGrid right (*) with internal scroll -->
                <DataGrid Grid.Column="1"
                          x:Name="dgDepolar"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          Background="White"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          MouseDoubleClick="dgDepolar_MouseDoubleClick"
                          ScrollViewer.CanContentScroll="True"
                          ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Depo Adi" Binding="{Binding DepoAdi}" Width="200"/>
                        <DataGridTextColumn Header="Aciklama" Binding="{Binding Aciklama}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Alt: Guzergah (1/2 ekran) -->
        <Border Grid.Row="1" Background="#E8F0FE" BorderBrush="Gray" BorderThickness="1" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Sol: guzergah formu -->
                <Border Grid.Column="0" BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,10,0" VerticalAlignment="Stretch">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Height="Auto">
                        <StackPanel>
                            <!-- Guzergah Tanimi Formu -->
                            <TextBlock Text="Guzergah Tanimi" FontSize="18" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="cmbCikisDepo" materialDesignControls:HintAssist.Hint="Cikis Noktasi" Width="300" Margin="0,0,0,5" DisplayMemberPath="Value" SelectedValuePath="Key"/>
                            <ComboBox x:Name="cmbVarisDepo" materialDesignControls:HintAssist.Hint="Varis Noktasi" Width="300" Margin="0,0,0,5" DisplayMemberPath="Value" SelectedValuePath="Key"/>
                            <TextBox x:Name="txtFiyat" materialDesignControls:HintAssist.Hint="Fiyat" Width="300" Margin="0,0,0,5"/>
                            <TextBox x:Name="txtGuzergahAciklama" materialDesignControls:HintAssist.Hint="Aciklama (opsiyonel)" Width="300" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,10">
                                <Button Content="Tumunu Ac" Width="120" Margin="0,0,10,0" Click="BtnTumunuAc_Click"/>
                                <Button Content="Tumunu Kapat" Width="120" Click="BtnTumunuKapat_Click"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,10">
                                <Button Content="Kaydet" Width="120" Margin="0,0,10,0" Click="BtnGuzergahKaydet_Click"/>
                                <Button Content="Guncelle" Width="120" Margin="0,0,10,0" Click="BtnGuzergahGuncelle_Click"/>
                                <Button Content="Sil" Width="120" Click="BtnGuzergahSil_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Sag: gruplu guzergah listesi -->
                <DataGrid Grid.Column="1"
                          x:Name="dgGuzergah"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          Background="White"
                          ItemsSource="{Binding Source={StaticResource GuzergahGrouped}}"
                          ScrollViewer.CanContentScroll="True"
                          ScrollViewer.IsDeferredScrollingEnabled="True"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="True"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          MouseDoubleClick="dgGuzergah_MouseDoubleClick">
                    <DataGrid.GroupStyle>
                        <GroupStyle>
                            <GroupStyle.HeaderTemplate>
                                <DataTemplate>
                                    <Expander IsExpanded="False">
                                        <Expander.Header>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Converter={StaticResource GroupStatsConverter}}" Foreground="Gray"/>
                                            </StackPanel>
                                        </Expander.Header>
                                    </Expander>
                                </DataTemplate>
                            </GroupStyle.HeaderTemplate>
                            <GroupStyle.Panel>
                                <ItemsPanelTemplate>
                                    <DataGridRowsPresenter/>
                                </ItemsPanelTemplate>
                            </GroupStyle.Panel>
                        </GroupStyle>
                    </DataGrid.GroupStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Varis Noktasi" Binding="{Binding VarisDepoAdi}" Width="150"/>
                        <DataGridTextColumn Header="Fiyat" Binding="{Binding Fiyat}" Width="90"/>
                        <DataGridTextColumn Header="Aciklama" Binding="{Binding Aciklama}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>