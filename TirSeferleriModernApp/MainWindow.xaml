<Window x:Class="TirSeferleriModernApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:TirSeferleriModernApp"
        xmlns:viewmodels="clr-namespace:TirSeferleriModernApp.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:conv="clr-namespace:TirSeferleriModernApp.Converters"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Tır Seferleri Uygulaması"
        Height="720" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="White"
        Loaded="MainWindow_Loaded">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <conv:SelectedPlakaToItemMatchConverter x:Key="PlakaMatch"/>
        <conv:SelectedMenuToCheckedConverter x:Key="MenuChecked"/>

        <!-- Snackbar mesajı: uzun metinler için sarma ve pencere genişliği kadar max genişlik -->
        <Style TargetType="materialDesign:SnackbarMessage">
            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="None"
                                   MaxWidth="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ActualWidth}"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MenuButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <Style x:Key="SubMenuButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="FontWeight" Value="Normal"/>
        </Style>

        <Style x:Key="AltMenuToggleStyle" TargetType="ToggleButton">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#44527A"/>
            <Setter Property="BorderBrush" Value="#8794BF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="#5A6AA3"/>
                    <Setter Property="BorderBrush" Value="#B3C0F0"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <DockPanel LastChildFill="True">
        <!-- Üst MENU + sağda Debug butonu -->
        <DockPanel DockPanel.Dock="Top" Background="LightGray" Height="26">
            <!-- Sağda debug butonu -->
            <Button Content="🐞" ToolTip="Debug Listesi"
                    Command="{Binding DataContext.DebugListesiKomutu, RelativeSource={RelativeSource AncestorType=Window}}"
                    DockPanel.Dock="Right"
                    Background="Transparent" BorderThickness="0" Padding="8,0"
                    HorizontalAlignment="Right" VerticalAlignment="Stretch"/>
            <!-- Sol tarafta mevcut menü -->
            <Menu x:Name="TopBarMenu"
                  Background="LightGray"
                  Foreground="Black"
                  FontWeight="Bold"
                  Height="26">
                <MenuItem x:Name="AA_MenuItem"
                          Header="AA"
                          MouseEnter="AA_MenuItem_MouseEnter"
                          MouseLeave="AA_MenuItem_MouseLeave"
                          Height="26">
                    <!-- Debug Listesi bu açılır menüden taşındı -->
                    <MenuItem Header="Alt 2" Command="{Binding TopAlt2Command}"/>
                    <MenuItem Header="Alt 3" Command="{Binding TopAlt3Command}"/>
                    <MenuItem Header="Alt 4" Command="{Binding TopAlt4Command}"/>
                    <MenuItem Header="Alt 5" Command="{Binding TopAlt5Command}"/>
                </MenuItem>
            </Menu>
        </DockPanel>

        <!-- Durum Çubuğu -->
        <StatusBar Background="#3A4A6F" Foreground="White" DockPanel.Dock="Bottom" Height="30" Padding="5">
            <StatusBarItem>
                <TextBlock x:Name="StatusBarTextBlock" Text="{Binding StatusText}" FontSize="12" VerticalAlignment="Center" />
            </StatusBarItem>
        </StatusBar>

        <!-- Sol MENU -->
        <DockPanel x:Name="LeftMenuPanel" Width="300" Background="#2E3A59" VerticalAlignment="Stretch" DockPanel.Dock="Left" LastChildFill="False">
            <!-- Geri Dön Butonu -->
            <Button x:Name="BtnGeriDon"
                    Content="🔙 Geri Dön"
                    Margin="10,10,10,0"
                    Command="{Binding BtnGeriDonCommand}"
                    Style="{StaticResource MenuButtonStyle}"
                    Visibility="{Binding GeriDonVisibility}"
                    DockPanel.Dock="Top"/>

            <!-- Başlık + Minimize -->
            <Grid Margin="10,10,10,0" DockPanel.Dock="Top">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="HeaderText"
                           Text="🚚 MDRLOG"
                           FontWeight="Bold"
                           FontSize="20"
                           Foreground="White"
                           Margin="6,10,6,10"
                           Grid.Column="0"/>
                <Button x:Name="BtnToggleLeftMenu"
                        Content="❮"
                        ToolTip="Menüyü daralt/genişlet"
                        Width="28" Height="28"
                        Margin="0,6,6,6"
                        Click="BtnToggleLeftMenu_Click"
                        Grid.Column="1"
                        Background="#44527A"
                        Foreground="White"
                        BorderBrush="#8794BF"/>
            </Grid>

            <!-- Araçlar Menüsü -->
            <StackPanel x:Name="AraclarMenusuContainer" Background="#2E3A59" Margin="10,10,10,0" Visibility="Visible" DockPanel.Dock="Top">
                <Button x:Name="BtnAraclarMenu"
                        Content="🚛 Araçlar"
                        Command="{Binding ToggleAraclarMenuCommand}"
                        Style="{StaticResource MenuButtonStyle}" />
                <!-- Araçlar menüsü için ItemsControl -->
                <ItemsControl x:Name="AraclarMenuContainer" ItemsSource="{Binding AraclarMenu}">
                    <ItemsControl.Style>
                        <Style TargetType="ItemsControl">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding AraclarMenuAcik}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ItemsControl.Style>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <Button Content="{Binding}"
                                        Command="{Binding DataContext.SelectAracCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource SubMenuButtonStyle}"
                                        Margin="10,5,10,0" />

                                <!-- ikinci menü: seçilen plaka altında -->
                                <ItemsControl ItemsSource="{Binding DataContext.SeciliPlakaAltMenu, RelativeSource={RelativeSource AncestorType=DockPanel}}">
                                    <ItemsControl.Style>
                                        <Style TargetType="ItemsControl">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Value="True">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding Converter="{StaticResource PlakaMatch}">
                                                            <Binding Path="DataContext.SelectedPlaka" RelativeSource="{RelativeSource AncestorType=DockPanel}" Mode="OneWay"/>
                                                            <Binding Mode="OneWay"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ItemsControl.Style>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <ToggleButton Content="{Binding Baslik}"
                                                              Command="{Binding Komut}"
                                                              Style="{StaticResource AltMenuToggleStyle}"
                                                              Margin="25,2,10,0">
                                                    <ToggleButton.IsChecked>
                                                        <MultiBinding Converter="{StaticResource MenuChecked}" Mode="OneWay">
                                                            <Binding Path="DataContext.AktifAltMenu" RelativeSource="{RelativeSource AncestorType=DockPanel}" Mode="OneWay"/>
                                                            <Binding Path="Baslik" Mode="OneWay"/>
                                                        </MultiBinding>
                                                    </ToggleButton.IsChecked>
                                                </ToggleButton>

                                                <!-- Giderler seçiliyken gösterilecek 2. seviye alt menü -->
                                                <StackPanel Margin="35,2,10,6">
                                                    <StackPanel.Style>
                                                        <Style TargetType="StackPanel">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition Binding="{Binding Baslik}" Value="💸 Giderler"/>
                                                                        <Condition Binding="{Binding DataContext.AktifAltMenu, RelativeSource={RelativeSource AncestorType=DockPanel}}" Value="💸 Giderler"/>
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </MultiDataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </StackPanel.Style>
                                                    <Button Content="Yakıt"    Command="{Binding DataContext.BtnYakitCommand, RelativeSource={RelativeSource AncestorType=DockPanel}}"   Style="{StaticResource SubMenuButtonStyle}" Margin="0,2,0,0"/>
                                                    <Button Content="Sanai"    Command="{Binding DataContext.BtnSanaiCommand, RelativeSource={RelativeSource AncestorType=DockPanel}}"   Style="{StaticResource SubMenuButtonStyle}" Margin="0,2,0,0"/>
                                                    <Button Content="Genel"    Command="{Binding DataContext.BtnGenelCommand, RelativeSource={RelativeSource AncestorType=DockPanel}}"   Style="{StaticResource SubMenuButtonStyle}" Margin="0,2,0,0"/>
                                                    <Button Content="Vergiler (araç)" Command="{Binding DataContext.BtnVergilerAracCommand, RelativeSource={RelativeSource AncestorType=DockPanel}}" Style="{StaticResource SubMenuButtonStyle}" Margin="0,2,0,0"/>
                                                    <Button Content="Personel" Command="{Binding DataContext.BtnPersonelCommand, RelativeSource={RelativeSource AncestorType=DockPanel}}" Style="{StaticResource SubMenuButtonStyle}" Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- Tanımlar Menüsü -->
            <StackPanel x:Name="TanimlarMenusuContainer" Background="#2E3A59" Margin="10,10,10,0" Visibility="Visible" DockPanel.Dock="Top">
                <Button x:Name="BtnTanimlarMenusu"
                        Content="📋 Tanımlar"
                        Command="{Binding ToggleTanimlarMenuCommand}"
                        Style="{StaticResource MenuButtonStyle}"
                        Visibility="{Binding ShowTanimlar, Converter={StaticResource BoolToVis}}" />
                <StackPanel x:Name="TanimlarMenu" Background="#3A4A6F" Margin="0,0,0,0">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TanimlarMenuAcik}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <Button Content="Çekici, Dorse ve Şoför Tanımla"
                            Margin="10,5,10,6"
                            Style="{StaticResource SubMenuButtonStyle}"
                            Command="{Binding AcTanimlarCommand}"/>

                    <!-- Yeni alt menü: Depo ve Güzergah Tanımı -->
                    <Button Content="Depo ve Güzergah Tanımı"
                            Margin="10,0,10,10"
                            Style="{StaticResource SubMenuButtonStyle}"
                            Command="{Binding AcDepoGuzergahTanimCommand}"/>
                </StackPanel>
            </StackPanel>

            <!-- İSTENEN: Tanımların bir alt satırında Kâr butonu (üst seviye) -->
            <Button x:Name="BtnKar"
                    Content="Kâr"
                    Command="{Binding BtnKarCommand}"
                    Style="{StaticResource MenuButtonStyle}"
                    Margin="10,5,10,0"
                    DockPanel.Dock="Top"/>
        </DockPanel>

        <!-- İçerik Alanı -->
        <Grid Margin="10">
            <!-- ViewModel.CurrentContent burada render edilir -->
            <ContentPresenter Content="{Binding CurrentContent}"/>

            <!-- İçerik yoksa placeholder başlık göster -->
            <TextBlock Text="Ana Ekran"
                       FontSize="36"
                       FontWeight="Bold"
                       Foreground="Gray"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Top"
                       Margin="0,20,0,20">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding CurrentContent}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>

            <!-- Global Snackbar -->
            <materialDesign:Snackbar x:Name="GlobalSnackbar"
                                     HorizontalAlignment="Stretch"
                                     VerticalAlignment="Bottom"
                                     Margin="16"
                                     MessageQueue="{Binding MessageQueue, Mode=OneWay}"/>
        </Grid>
    </DockPanel>
</Window>
